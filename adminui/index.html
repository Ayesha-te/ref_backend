<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nexocart Admin Panel</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">N</div>
      <div>
        <h1>Nexocart</h1>
        <p>Admin Panel</p>
        <button id="approveUsersBtn" class="btn">Approve Users</button>
      </div>
    </div>
    <nav>
      <button class="nav-btn" data-section="dashboard">Dashboard</button>
      <button class="nav-btn" data-section="users">Users</button>
      <button class="nav-btn" data-section="deposits">Deposits</button>
      <button class="nav-btn" data-section="withdrawals">Withdrawals</button>
      <button class="nav-btn" data-section="referrals">Referrals</button>
      <button class="nav-btn" data-section="proofs">Signup Proofs</button>
      <button class="nav-btn" data-section="system">System</button>
      <button class="nav-btn" data-section="globalpool">Global Pool</button>
      <button class="nav-btn" data-section="systemoverview">System Overview</button>
      <button class="nav-btn" data-section="products">Products</button>
      <button class="nav-btn" data-section="orders">Orders</button>
      <div class="spacer"></div>
      <div class="config">
        <label>Admin Login</label>
        <input id="loginUsername" placeholder="Username or Email" />
        <input id="loginPassword" type="password" placeholder="Password" />
        <div class="row">
          <button id="loginBtn" class="btn">Login</button>
          <button id="logoutBtn" class="btn secondary">Logout</button>
        </div>
        <small id="authHint" class="muted">Uses JWT; tokens kept in-memory.</small>
      </div>
    </nav>
  </aside>

  <main class="content">
    <header class="toolbar">
      <h2 id="sectionTitle">Dashboard</h2>
      <div class="toolbar-right">
        <div id="authStatus" class="auth-status">Not Authenticated</div>
        <div id="status" class="status"></div>
      </div>
    </header>

    <section id="dashboard" class="section active">
      <div class="cards">
        <div class="card">
          <h3>Total Pending Users</h3>
          <div id="statPendingUsers" class="stat">—</div>
        </div>
        <div class="card">
          <h3>Pending Deposits</h3>
          <div id="statPendingDeposits" class="stat">—</div>
        </div>
        <div class="card">
          <h3>Pending Withdrawals</h3>
          <div id="statPendingWithdrawals" class="stat">—</div>
        </div>
        <div class="card">
          <h3>Total Referrals</h3>
          <div id="statTotalReferrals" class="stat">—</div>
        </div>
      </div>
    </section>

    <section id="users" class="section">
      <div class="section-head">
        <h3>Users</h3>
        <div class="actions">
          <button id="refreshUsers" class="btn">Refresh</button>
        </div>
      </div>
      <div class="filters">
        <input id="usersSearch" placeholder="Search username or email" />
        <select id="usersApproved">
          <option value="true" selected>Approved</option>
          <option value="">All</option>
          <option value="false">Not Approved</option>
        </select>
        <button id="applyUsersFilter" class="btn">Apply</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th data-sort="username">Username</th>
              <th data-sort="email">Email</th>
              <th>First</th>
              <th>Last</th>
              <th data-sort="is_active">Active</th>
              <th data-sort="is_staff">Staff</th>
              <th data-sort="is_approved">Approved</th>
              <th data-sort="rewards_usd">Rewards (USD)</th>
              <th data-sort="passive_income_usd">Passive Income (USD)</th>
              <th data-sort="current_income_usd">Current Income (USD)</th>
              <th data-sort="referrals_count">Referrals</th>
              <th>Bank</th>
              <th>Account</th>
              <th data-sort="date_joined">Joined</th>
              <th data-sort="last_login">Last Login</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersTbody">
            <tr><td colspan="16" class="muted">Loading...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="filters row">
        <input id="usersSearch2" placeholder="Search username or email" />
        <select id="usersApproved2">
          <option value="">Approved: All</option>
          <option value="true">Approved</option>
          <option value="false">Not Approved</option>
        </select>
        <select id="usersActive">
          <option value="">Active: All</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
        <select id="usersStaff">
          <option value="">Staff: All</option>
          <option value="true">Staff</option>
          <option value="false">Non-staff</option>
        </select>
        <input id="dateJoinedFrom" type="date" />
        <input id="dateJoinedTo" type="date" />
        <button id="applyUsersFilter2" class="btn">Apply</button>
      </div>
      <div class="pagination">
        <button id="usersPrev" class="btn">Prev</button>
        <span id="usersPageInfo" class="muted"></span>
        <button id="usersNext" class="btn">Next</button>
      </div>

      <h4 class="subheading">Pending Approval</h4>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>User Name</th>
              <th>Email</th>
              <th>Signup Tx ID</th>
              <th>Signup Proof</th>
              <th>Submitted At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="pendingUsersTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="deposits" class="section">
      <div class="section-head">
        <h3>Pending Deposits</h3>
        <div class="actions">
          <button id="refreshDeposits" class="btn">Refresh</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>User</th>
              <th>Email</th>
              <th>Tx ID</th>
              <th>Bank</th>
              <th>Account</th>
              <th>Proof</th>
              <th>Amount (USD)</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="depositsTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="withdrawals" class="section">
      <div class="section-head">
        <h3>Pending Withdrawals</h3>
        <div class="actions">
          <button id="refreshWithdrawals" class="btn">Refresh</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Email</th>
          <th>Tx ID</th>
          <th>Bank Name</th>
          <th>Account Name</th>
          <th>Amount (USD)</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
          </thead>
          <tbody id="withdrawalsTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="referrals" class="section">
      <div class="section-head">
        <h3>Referrals Summary</h3>
        <div class="actions">
          <button id="refreshReferrals" class="btn">Refresh</button>
        </div>
      </div>
      <div class="cards" id="referralSummaryCards"></div>
    </section>

    <section id="proofs" class="section">
      <div class="section-head">
        <h3>Signup Proofs (Pending)</h3>
        <div class="actions">
          <button id="refreshProofs" class="btn">Refresh</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>User</th>
              <th>Email</th>
              <th>File</th>
              <th>Uploaded</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="proofsTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="system" class="section">
      <div class="section-head">
        <h3>System Overview</h3>
      </div>
      <div id="systemContent"></div>
    </section>

    <section id="globalpool" class="section">
      <div class="section-head">
        <h3>Global Pool</h3>
      </div>
      <div class="cards">
        <div class="card">
          <h3>Payout Day</h3>
          <div id="globalPayoutDay" class="stat">—</div>
        </div>
        <div class="card">
          <h3>Current Pool Balance</h3>
          <div id="globalPoolBalance" class="stat">—</div>
        </div>
        <div class="card">
          <h3>Last Payout Amount</h3>
          <div id="globalPayoutAmount" class="stat">—</div>
        </div>
      </div>
      <div class="table-wrap" style="margin-top: 12px;">
        <table>
          <thead>
            <tr><th>User</th><th>Total Passive (USD)</th></tr>
          </thead>
          <tbody id="globalPoolUsersTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="systemoverview" class="section">
      <div class="section-head">
        <h3>System Overview</h3>
      </div>
      <div class="overview-content">
        <h4>How the Global Pool System Works</h4>
        <ul>
          <li><strong>Deposit Approval:</strong> Each time an admin approves and credits a user deposit, exactly <strong>$0.50 USD</strong> is automatically added to the global pool.</li>
          <li><strong>Weekly Distribution:</strong> Every <strong>Monday</strong>, the entire global pool balance is distributed equally among all approved users.</li>
          <li><strong>Calculation Example:</strong> If 20 deposits were approved this week → Pool = 20 × $0.50 = $10.00. If there are 100 approved users → Each user gets $10 ÷ 100 = $0.10 USD ≈ 28 PKR.</li>
          <li><strong>Withdrawal Tax:</strong> A <strong>20% tax</strong> is applied to global pool payouts before they are added to user wallets.</li>
          <li><strong>Automatic Process:</strong> The distribution happens automatically every Monday, and the net amount (after tax) is credited to each user's available balance.</li>
        </ul>
        
        <h4>Platform Economics</h4>
        <ul>
          <li><strong>User Share:</strong> 80% of each deposit goes to the user's earning balance for passive income.</li>
          <li><strong>Global Pool:</strong> Fixed $0.50 per approval goes to the global pool for weekly distribution.</li>
          <li><strong>Platform Operations:</strong> The remaining portion supports platform operations and maintenance.</li>
          <li><strong>Passive Earnings:</strong> Users earn daily passive income on their balance according to the schedule (0.4% to 1.3% daily).</li>
          <li><strong>Referral System:</strong> Users earn from referrals: 6% (L1), 3% (L2), 1% (L3) of signup fees.</li>
        </ul>
        
        <h4>Tax Structure</h4>
        <ul>
          <li><strong>Withdrawal Tax:</strong> 20% on all withdrawals (including global pool payouts).</li>
          <li><strong>No Tax on Deposits:</strong> Deposits are split according to the economics but no additional tax.</li>
          <li><strong>Referral Earnings:</strong> Paid directly to user wallets without additional tax.</li>
        </ul>
      </div>
    </section>

    <section id="products" class="section">
      <div class="section-head">
        <h3>Products</h3>
      </div>
      <div class="row" style="gap:8px;margin-bottom:8px;flex-wrap:wrap;align-items:flex-start;">
        <input id="newProductName" placeholder="Product name" style="min-width:200px;"/>
        <input id="newProductPrice" type="number" step="0.01" placeholder="Price (USD)" style="width:140px;"/>
        <input id="newProductDesc" placeholder="Description" style="min-width:280px;flex:1;"/>
        <input id="newProductImage" type="file" accept="image/*" style="max-width:220px;"/>
        <button id="addProductBtn" class="btn">Add</button>
      </div>
      <small class="muted">Note: Logged-in buyers get 10% discount on every product. Guests pay full price.</small>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Title</th><th>Price (USD)</th><th>Description</th><th>Active</th><th>Actions</th></tr>
          </thead>
          <tbody id="productsTbody"></tbody>
        </table>
      </div>
    </section>

    <section id="orders" class="section">
      <div class="section-head">
        <h3>Orders</h3>
        <div class="actions">
          <button id="refreshOrders" class="btn">Refresh</button>
          <select id="ordersFilterStatus">
            <option value="">All</option>
            <option value="PENDING">Pending</option>
            <option value="PAID">Paid</option>
            <option value="CANCELLED">Cancelled</option>
          </select>
          <button id="switchToLocal" class="btn secondary" title="Use http://localhost:8000/api">Use Local API</button>
          <button id="switchToProd" class="btn secondary" title="Use production API">Use Prod API</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Product</th>
              <th>Buyer</th>
              <th>Guest</th>
              <th>Tx ID</th>
              <th>Total (USD)</th>
              <th>Status</th>
              <th>Proof</th>
              <th>Placed</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="ordersTbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="toast" class="toast"></div>

  <script src="app.js"></script>
</body>
</html>